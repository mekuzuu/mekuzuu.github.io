---
title: "Github Actions + textlint + reviewdogで記事を校正する"
date: 2022-04-16T22:31:13+09:00
draft: true
---

Github Actionsを使って、Hugoで書いた記事にtextlintをかけてエラーが検出されたら、reviewdogでPull Requestにコメントするお話。

記事を書くときはbranchを切って、Pull Requestを作成する運用を前提としている。


## モチベーション
Hugoで書いた記事の質を高めること。

記事をあとで見返すと誤字脱字や日本語がおかしい部分を見つけたりするので、機械的に文章校正する仕組みを導入したい。

## 前提
* [textlint](https://github.com/textlint/textlint) v12.1.1
* [reviewdog/action-setup](https://github.com/reviewdog/action-setup) v1.0.3

## textlint
まず、textlintの設定。

textlintのルールのプリセットには、[preset-ja-technical-writing](https://github.com/textlint-ja/textlint-rule-preset-ja-technical-writing)を採用。  
全体的に少し厳しめの設定がデフォルト値らしいので、今後使いにくい部分などが出てきたら設定を緩くしていく。

textlintとルールのプリセットを`package.json`に追加。
```sh
npm init --yes

npm install --save-dev textlint

npm install textlint-rule-preset-ja-technical-writing
```

`.textlintrc`を作成し、textlintのルールを記載。
```json
{
  "rules": {
    "preset-ja-technical-writing": true
  }
}
```

## reviewdog/action-setup
次に、reviewdogとGithub Actionsの設定。

reviewdog/action-setupを用いることで、Github Actions上でいい感じにreviewdogを使うことができる。

workflowの設定ファイルはこんな感じ。  

```reviewdog.yml
name: reviewdog
on:
  push:
    branches:
      - master
  pull_request:

jobs:
 textlint:
    name: runner / textlint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: reviewdog/action-setup@v1
      - run: npm install
      - name: textlint
        env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          $(npm bin)/textlint -f checkstyle content/post/**.md | \
            reviewdog -f=checkstyle -name="textlint" -reporter=github-pr-review
```

reviewdogのRepositoryにworkflowのサンプルらしきファイルがあったので、これを参考にした。  
https://github.com/reviewdog/reviewdog/blob/master/.github/workflows/reviewdog.yml

## 動作
前節までの設定が完了して作成したPRに対して、意図通り動作している様子。
[![Image from Gyazo](https://i.gyazo.com/50f3b4bcdcb802cd6b5f445e1938a087.png)](https://gyazo.com/50f3b4bcdcb802cd6b5f445e1938a087)
