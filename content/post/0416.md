---
title: "Github Actions + textlint + reviewdogで記事を校正する"
date: 2022-04-16T22:31:13+09:00
draft: true
---

Github Actionsを使って、Hugoで書いた記事にtextlintをかけてエラーが検出されたら、reviewdogでPull Requestにコメントするやつを導入したお話。

textlintやreviewdogについての説明は割愛する。

## 成果物
導入したものがこちら。
[![Image from Gyazo](https://i.gyazo.com/50f3b4bcdcb802cd6b5f445e1938a087.png)](https://gyazo.com/50f3b4bcdcb802cd6b5f445e1938a087)

## モチベーション
記事をあとで見返すと誤字脱字や日本語がおかしい部分を見つけたりするので、記事を投稿する際に機械的に文章校正する仕組みを導入したかった。

## 前提
* [npm](https://github.com/npm/cli) v8.5.5
* [textlint](https://github.com/textlint/textlint) v12.1.1
* [reviewdog/action-setup](https://github.com/reviewdog/action-setup) v1.0.3
  * Github Actionsでいい感じにreviewdogを使うことができるやつ

## textlintの設定
まず、textlintを`package.json`に追加する。

```sh
npm init --yes

npm install --save-dev textlint
```

次に、textlintのルールのプリセットを追加する。

プリセットには、[preset-ja-technical-writing](https://github.com/textlint-ja/textlint-rule-preset-ja-technical-writing)を採用した。  
全体的に少し厳しめの設定がデフォルト値らしいので、今後使いにくい部分などが出てきたら設定を緩くしていく。

```sh
npm install textlint-rule-preset-ja-technical-writing
```

最後に、リポジトリのルート直下に`.textlintrc`を作成し、適用するルールの設定を記載する。
```json
{
  "rules": {
    "preset-ja-technical-writing": true
  }
}
```

## GitHub Actionsの設定
Github Actionsでtextlintとreviewdogを実行するworkflowの設定。

reviewdogのリポジトリにworkflowのサンプルがあったので、それを参考にした。  

```reviewdog.yml
name: reviewdog
on:
  push:
    branches:
      - master
  pull_request:

jobs:
 textlint:
    name: runner / textlint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: reviewdog/action-setup@v1
      - run: npm install
      - name: textlint
        env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          $(npm bin)/textlint -f checkstyle content/post/**.md | \
            reviewdog -f=checkstyle -name="textlint" -reporter=github-pr-review
```
ざっくり以下のような内容となっている。

* Push（master branch only）もしくはPull Requestをトリガに設定
* npmをインストール
* reviewdogがコメントを書き込めるように`GITHUB_TOKEN`を設定
* textlintの実行結果をpipeしてreviewdogに渡す

`GITHUB_TOKEN`の部分は自動的に生成される為、特に意識しなくてよい。

## 参考
* https://textlint.github.io/
* https://github.com/reviewdog/reviewdog/blob/master/.github/workflows/reviewdog.yml
* https://docs.github.com/en/actions
